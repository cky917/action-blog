<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>functional-javascript-v3学习笔记 | 蹦蹬儿你个蹦蹬儿</title>
    <meta name="description" content="">
    <link rel="shortcut icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.c09221a0.css" as="style"><link rel="preload" href="/assets/js/app.99350028.js" as="script"><link rel="preload" href="/assets/js/4.30ee6c09.js" as="script"><link rel="preload" href="/assets/js/27.722cb4e9.js" as="script"><link rel="preload" href="/assets/js/2.4b712851.js" as="script"><link rel="prefetch" href="/assets/js/10.52949b95.js"><link rel="prefetch" href="/assets/js/11.c52740e4.js"><link rel="prefetch" href="/assets/js/12.2f2cf883.js"><link rel="prefetch" href="/assets/js/13.89c55872.js"><link rel="prefetch" href="/assets/js/14.9be3e813.js"><link rel="prefetch" href="/assets/js/15.b7e581a8.js"><link rel="prefetch" href="/assets/js/16.f000b245.js"><link rel="prefetch" href="/assets/js/17.f96efb32.js"><link rel="prefetch" href="/assets/js/18.a1b5ee98.js"><link rel="prefetch" href="/assets/js/19.98c14b1a.js"><link rel="prefetch" href="/assets/js/20.0a3ea515.js"><link rel="prefetch" href="/assets/js/21.6fcaf99f.js"><link rel="prefetch" href="/assets/js/22.3c58969d.js"><link rel="prefetch" href="/assets/js/23.752d84e3.js"><link rel="prefetch" href="/assets/js/24.5ec86a9d.js"><link rel="prefetch" href="/assets/js/25.22de6e9e.js"><link rel="prefetch" href="/assets/js/26.39b566c0.js"><link rel="prefetch" href="/assets/js/28.5e396f63.js"><link rel="prefetch" href="/assets/js/29.ba4d756b.js"><link rel="prefetch" href="/assets/js/3.6f8a5d5d.js"><link rel="prefetch" href="/assets/js/30.84e8b43f.js"><link rel="prefetch" href="/assets/js/31.578f1bf0.js"><link rel="prefetch" href="/assets/js/32.10125e04.js"><link rel="prefetch" href="/assets/js/33.a037773e.js"><link rel="prefetch" href="/assets/js/34.8d504839.js"><link rel="prefetch" href="/assets/js/35.1139356e.js"><link rel="prefetch" href="/assets/js/36.3e2d2dee.js"><link rel="prefetch" href="/assets/js/37.c0375bbe.js"><link rel="prefetch" href="/assets/js/38.f77ed73e.js"><link rel="prefetch" href="/assets/js/39.4237e7ed.js"><link rel="prefetch" href="/assets/js/40.2fd6fe6a.js"><link rel="prefetch" href="/assets/js/41.e62a458c.js"><link rel="prefetch" href="/assets/js/42.b113743d.js"><link rel="prefetch" href="/assets/js/43.7db99ebf.js"><link rel="prefetch" href="/assets/js/44.347069b6.js"><link rel="prefetch" href="/assets/js/45.57c09c23.js"><link rel="prefetch" href="/assets/js/46.b4233087.js"><link rel="prefetch" href="/assets/js/47.b1cb7431.js"><link rel="prefetch" href="/assets/js/48.f5b2a916.js"><link rel="prefetch" href="/assets/js/49.d5e5e0c4.js"><link rel="prefetch" href="/assets/js/5.0b478fe8.js"><link rel="prefetch" href="/assets/js/50.49d89c01.js"><link rel="prefetch" href="/assets/js/51.20a56e80.js"><link rel="prefetch" href="/assets/js/52.34f25eeb.js"><link rel="prefetch" href="/assets/js/53.29043741.js"><link rel="prefetch" href="/assets/js/54.217365ad.js"><link rel="prefetch" href="/assets/js/55.4a6cea76.js"><link rel="prefetch" href="/assets/js/56.58fe70cb.js"><link rel="prefetch" href="/assets/js/57.6edf337a.js"><link rel="prefetch" href="/assets/js/58.3a24eaee.js"><link rel="prefetch" href="/assets/js/59.3c003614.js"><link rel="prefetch" href="/assets/js/6.a802ca76.js"><link rel="prefetch" href="/assets/js/60.160915ca.js"><link rel="prefetch" href="/assets/js/61.d8a797df.js"><link rel="prefetch" href="/assets/js/62.123fb47c.js"><link rel="prefetch" href="/assets/js/63.c17a9c09.js"><link rel="prefetch" href="/assets/js/64.41ccbea2.js"><link rel="prefetch" href="/assets/js/65.9218a29b.js"><link rel="prefetch" href="/assets/js/66.5e4c8f7d.js"><link rel="prefetch" href="/assets/js/7.7bd8b61d.js"><link rel="prefetch" href="/assets/js/8.22ba5fa6.js"><link rel="prefetch" href="/assets/js/9.f16feb13.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c09221a0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-cky"><header class="header" data-v-9d6fcc1a><div data-v-3da9dd48 data-v-9d6fcc1a><nav class="navbar" data-v-3da9dd48><div class="container" data-v-3da9dd48><a href="/" class="router-link-active" data-v-3da9dd48><span class="navbar-title" data-v-3da9dd48>蹦蹬儿你个蹦蹬儿</span></a> <div class="search-box search-box" data-v-3da9dd48><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <div class="navbar-toggler" data-v-3da9dd48><svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu" data-v-3da9dd48 data-v-3da9dd48><line x1="3" y1="12" x2="21" y2="12" data-v-3da9dd48 data-v-3da9dd48></line><line x1="3" y1="6" x2="21" y2="6" data-v-3da9dd48 data-v-3da9dd48></line><line x1="3" y1="18" x2="21" y2="18" data-v-3da9dd48 data-v-3da9dd48></line></svg></div> <div class="navbar-links" data-v-3da9dd48><a href="/" class="navbar-link router-link-active" data-v-3da9dd48>
            Home
          </a><a href="/tag" class="navbar-link" data-v-3da9dd48>
            Tags
          </a><a href="/about-me" class="navbar-link" data-v-3da9dd48>
            About Me
          </a><a href="https://github.com/cky917/action-blog" target="_blank" rel="noopener noreferrer" class="navbar-link" data-v-3da9dd48>
            Github
          </a></div></div></nav> <div class="navbar-holder" style="display:none;" data-v-3da9dd48></div></div></header> <div class="container" data-v-44e5f908><aside class="aside" data-v-44e5f908><div class="main-div" data-v-44e5f908></div></aside> <main class="main" data-v-44e5f908><div class="post-container" data-v-428ca122 data-v-44e5f908 data-v-44e5f908><h1 class="title" data-v-428ca122>functional-javascript-v3学习笔记</h1> <div class="post-info info" data-v-5f03bfd4 data-v-428ca122><span class="info-item" data-v-5f03bfd4>十一月 11, 2019</span> <span class="visitor-count info-item" data-v-d99d6d0e data-v-5f03bfd4><!----> <span id="busuanzi_container_page_pv" data-v-d99d6d0e>
    阅读量：
    <span id="busuanzi_value_page_pv" data-v-d99d6d0e><svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="load-icon feather feather-loader" data-v-d99d6d0e data-v-d99d6d0e><line x1="12" y1="2" x2="12" y2="6" data-v-d99d6d0e data-v-d99d6d0e></line><line x1="12" y1="18" x2="12" y2="22" data-v-d99d6d0e data-v-d99d6d0e></line><line x1="4.93" y1="4.93" x2="7.76" y2="7.76" data-v-d99d6d0e data-v-d99d6d0e></line><line x1="16.24" y1="16.24" x2="19.07" y2="19.07" data-v-d99d6d0e data-v-d99d6d0e></line><line x1="2" y1="12" x2="6" y2="12" data-v-d99d6d0e data-v-d99d6d0e></line><line x1="18" y1="12" x2="22" y2="12" data-v-d99d6d0e data-v-d99d6d0e></line><line x1="4.93" y1="19.07" x2="7.76" y2="16.24" data-v-d99d6d0e data-v-d99d6d0e></line><line x1="16.24" y1="7.76" x2="19.07" y2="4.93" data-v-d99d6d0e data-v-d99d6d0e></line></svg></span></span></span> </div> <div class="post-content content__default" data-v-428ca122><p>这是我在frontend-masters上学习Kyle Simpson的课程<a href="https://frontendmasters.com/courses/functional-javascript-v3/" target="_blank" rel="noopener noreferrer">functional-javascript-v3<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的学习笔记。这个大佬就是《You don't know JS》的作者，</p> <h2 id="为什么要用函数式编程"><a href="#为什么要用函数式编程" class="header-anchor">#</a> 为什么要用函数式编程</h2> <h3 id="命令式vs声明式"><a href="#命令式vs声明式" class="header-anchor">#</a> 命令式vs声明式</h3> <p>命令式的告诉了我们怎么做，而声明式告诉了我们结果是什么。</p> <p>命令式的缺点是，维护者必须读完整段代码，在脑海里模拟执行之后才能了解这段代码的意图，然而人脑和电脑相比是很不擅长计算执行的，命令式让维护变得困难。</p> <p>注释并不是告诉代码意图的最佳途径，一些坏的、过时的注释还不如不要存在。一段好的代码应该是能清晰地讲述一个stroy，而注释不应该和代码表现的意图重复，
比如<code>i++ // 增加i</code>，注释应该注重在<code>why</code>而不是<code>what</code>。</p> <p>如果一段代码能够很清晰的表明<code>what</code>，我们就根本不需要注释了，这就是声明式。命令式和声明式不是绝对的，而是相对的概念。如果你长期使用函数式编程之后看到<code>for</code>循环，你会说 这是命令式。而当你长期使用一种很底层的编程语言，然后你看到<code>for</code>循环，你可能会说 这是声明式。</p> <h2 id="function"><a href="#function" class="header-anchor">#</a> function</h2> <blockquote><p>Function: the semantic relationship between input and computed output</p></blockquote> <p>函数是对于输入和输出（经过计算的）的一个语义化的关系的表现。</p> <h3 id="副作用"><a href="#副作用" class="header-anchor">#</a> 副作用</h3> <p>会产生副作用的操作：</p> <ul><li>I/O (console, files)</li> <li>Database Storage</li> <li>Network Calls</li> <li>DOM</li> <li>Timestamps</li> <li>Random Numbers</li> <li>CPU Heat</li> <li>CPU Time Delay</li></ul> <p>不是要“完全没有副作用”，而是尽量避免它们，或者单独提出来让它们变得很容易辨别。因为正如我们没有必要去验证<code>1 + 1 = 2</code>一样，函数式的代码我们很容易确保输入输出的正确性，如果程序出了bug，排除了函数式代码，那大部分Bug原因来自于副作用的代码，让副作用代码更明显，有助于我们排除问题。</p> <h3 id="纯函数"><a href="#纯函数" class="header-anchor">#</a> 纯函数</h3> <p>纯函数的关键不在于函数的定义，而在于函数的调用方式。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> z <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">addTwo</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x <span class="token operator">+</span> y
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">addAnother</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">addTwo</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">+</span> z
<span class="token punctuation">}</span>

<span class="token function">addAnother</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span> <span class="token comment">//42</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>这段代码的问题不是<code>z</code>是否是<code>const</code> 还是<code>var</code>，而是执行<code>addAnother</code>函数的时候，每次都会去检测调用时<code>z</code>以上的所有代码，判断z的值是否被改变了，然后才能计算出结果。如果是纯函数，则可以在一个隔离的情况下运行，而且也不担心会影响到外部。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">addAnother</span><span class="token punctuation">(</span><span class="token parameter">z</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">addTwo</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> x <span class="token operator">+</span> y <span class="token operator">+</span> z
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">addAnother</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span> <span class="token comment">// 42</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> obj<span class="token punctuation">.</span>id
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这不是一个纯函数，因为纯函数的定义是相同的输入一定会返回相同的输出。</p> <p>函数的纯度：能决定你对你代码自信的程度。尽可能的使用纯函数。</p> <h3 id="提取不纯的部分"><a href="#提取不纯的部分" class="header-anchor">#</a> 提取不纯的部分</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">addComment</span><span class="token punctuation">(</span><span class="token parameter">userID<span class="token punctuation">,</span> comment</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> record <span class="token operator">=</span> <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token function">uniqueID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    userID<span class="token punctuation">,</span>
    text<span class="token punctuation">:</span> comment
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> elem <span class="token operator">=</span> <span class="token function">buildCommentElement</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span>
  commentList<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>elem<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">addComment</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token string">'This is my first comment'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>这不是一个纯函数，包含了生成<code>uniqueID</code>以及DOM操作这2种副作用操作。提取副作用之后：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">newComment</span><span class="token punctuation">(</span><span class="token parameter">userID<span class="token punctuation">,</span> commentID<span class="token punctuation">,</span> comment</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> record <span class="token operator">=</span> <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> commentID<span class="token punctuation">,</span>
    userID<span class="token punctuation">,</span>
    text<span class="token punctuation">:</span> comment
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">buildCommentElement</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> commentID <span class="token operator">=</span> <span class="token function">uniqueID</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> elem <span class="token operator">=</span> <span class="token function">newComment</span><span class="token punctuation">(</span>
  <span class="token number">42</span><span class="token punctuation">,</span>
  commentID<span class="token punctuation">,</span>
  <span class="token string">'This is my first comment'</span>
<span class="token punctuation">)</span>

commentList<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>elem<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="包含不纯部分"><a href="#包含不纯部分" class="header-anchor">#</a> 包含不纯部分</h3> <p>如果实在无法避免一些有副作用的操作，尽量操作副本避免影响入参或者别的地方。</p> <h2 id="arguments"><a href="#arguments" class="header-anchor">#</a> Arguments</h2> <p>首先明确一下 <code>parameters</code>和<code>arguments</code>的区别</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x <span class="token operator">+</span> y
<span class="token punctuation">}</span>

<span class="token function">a</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>这里的<code>x</code>和<code>y</code>是<code>parameters</code>，而<code>3</code>和<code>5</code>则是<code>arguments</code>。<code>parameters</code>指的是函数定义时的参数变量，而<code>arguments</code>是指调用时传进去的值。</p> <p>一元一次函数: 一个输入对应一个输出</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">sum</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>二元一次函数: 两个输入对应一个输出</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sun</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x <span class="token operator">+</span> y
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这其实是描述一个函数的形状，为什么我们需要了解一个函数的形状呢，因为当我们像拼积木一样拼接函数时，我们需要保证每个连接点的凸起和凹陷都能准确对上。</p> <h3 id="arguments-shape-adapter"><a href="#arguments-shape-adapter" class="header-anchor">#</a> Arguments shape adapter</h3> <p>我们也可以写一些<code>adapter</code>作为中间件，让函数的“形状”变成我们想要的。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// unary adapter</span>
<span class="token keyword">function</span> <span class="token function">unary</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">one</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// binary adapter</span>
<span class="token keyword">function</span> <span class="token function">binary</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">two</span><span class="token punctuation">(</span><span class="token parameter">arg1<span class="token punctuation">,</span> arg2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span>arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> args
<span class="token punctuation">}</span>

<span class="token keyword">const</span> g <span class="token operator">=</span> <span class="token function">unary</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
<span class="token keyword">const</span> h <span class="token operator">=</span> <span class="token function">binary</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>

<span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// [1]</span>
<span class="token function">h</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// [1,2]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// reverse adapter</span>
<span class="token keyword">function</span> <span class="token function">reverseArgs</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">reversed</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> args
<span class="token punctuation">}</span>
<span class="token keyword">const</span> g <span class="token operator">=</span> <span class="token function">reverseArgs</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span>
<span class="token function">g</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">// 4,3,2,1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="equational-reasoning"><a href="#equational-reasoning" class="header-anchor">#</a> Equational Reasoning</h2> <h3 id="point-free"><a href="#point-free" class="header-anchor">#</a> point free</h3> <p><code>point free</code>是指一个函数在定义时，不需要指明它的入参。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">getPerson</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">onPerson</span><span class="token punctuation">(</span><span class="token parameter">person</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">renderPerson</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>因为<code>onPerson</code>和<code>renderPerson</code>的入参个数是一致的，也就是'形状'一致，所以它们是可互换(interchangeable)的。所以可以这样：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">getPerson</span><span class="token punctuation">(</span>renderPerson<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="shape"><a href="#shape" class="header-anchor">#</a> shape</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">isOdd</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> v <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">isEven</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">!</span><span class="token function">isOdd</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">isEven</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><code>isEven</code>虽然也可以用<code>return v % 2 === 0</code> 来返回，但是这样写能够明确表示两个函数的关系：<code>isEven</code>和<code>isOdd</code>是相反的。而<code>isEven</code>和<code>isOdd</code>的形状是一致的，所以也可以写成：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">not</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">negated</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">isOdd</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> v <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> isEven <span class="token operator">=</span> <span class="token function">not</span><span class="token punctuation">(</span>isOdd<span class="token punctuation">)</span>

<span class="token function">isEven</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="advanced-point-free"><a href="#advanced-point-free" class="header-anchor">#</a> Advanced point free</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token parameter">y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">forX</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> x <span class="token operator">%</span> y
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">eq</span><span class="token punctuation">(</span><span class="token parameter">y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">forX</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> x <span class="token operator">===</span> y
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> mod2 <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> eq1 <span class="token operator">=</span> <span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">isOdd</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">eq1</span><span class="token punctuation">(</span><span class="token function">mod2</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>上面还没把<code>isOdd</code>彻底<code>point free</code>，我们可以引入<code>compose</code>方法：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> mod2 <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> eq1 <span class="token operator">=</span> <span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token parameter">fn2<span class="token punctuation">,</span> fn1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> funciton <span class="token function">composed</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">fn2</span><span class="token punctuation">(</span><span class="token function">fn1</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> isOdd <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>eq1<span class="token punctuation">,</span> mod2<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>再简化掉2个函数的声明</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> isOdd <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="closure"><a href="#closure" class="header-anchor">#</a> Closure</h2> <blockquote><p>Closure is when a function 'remembers' the variables around it even when that function is executed elsewhere.</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">unary</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">addAnother</span><span class="token punctuation">(</span><span class="token parameter">z</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> x <span class="token operator">+</span> y <span class="token operator">+</span> z
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// impure</span>
<span class="token keyword">function</span> <span class="token function">strBuilder</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> v <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      str <span class="token operator">+=</span> v
      <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> str
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// pure</span>
<span class="token keyword">function</span> <span class="token function">strBuilder</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> v <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">strBuilder</span><span class="token punctuation">(</span>str <span class="token operator">+</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> str
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="lazy-or-eager"><a href="#lazy-or-eager" class="header-anchor">#</a> lazy or eager</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// lazy</span>
<span class="token keyword">function</span> <span class="token function">repeater</span><span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">allTheAs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// eager</span>
<span class="token keyword">function</span> <span class="token function">repeater</span><span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">allTheAs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> str
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> <span class="token constant">A</span> <span class="token operator">=</span> <span class="token function">repeater</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>

<span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 'AAAAAAAAAA'</span>
<span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 'AAAAAAAAAA'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>这2种形式都都各有优劣，要根据实际情况选择。比如如果会多次被调用的情况，选择<code>eager</code>模式，可以只计算一次。如果调用几率小，可以用<code>lazy</code>模式，按需计算。</p> <h3 id="memoization"><a href="#memoization" class="header-anchor">#</a> Memoization</h3> <p>但是如果我们既希望耗时的计算只计算一次，又希望它在第一次被调用的时候才执行呢？</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">repeater</span><span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> str
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">allTheAs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>str <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      str <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> str
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>上面这种写法很好，完全可以实现我们的需求，但是函数内部看上去有些不纯，因为它改变了<code>str</code>。我们有一个更加声明式的工具函数<code>memoize</code>，将看似不纯的地方提出来，让我们更关注重点的部分：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">repeater</span><span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">memoize</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">allTheAs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>memorize</code>是一个<code>adapter</code>。什么时候适合使用它呢？当input常常不一致时，不适合，因为会占用太多内存去缓存，反之则适合。</p> <h3 id="referential-transparency"><a href="#referential-transparency" class="header-anchor">#</a> Referential Transparency</h3> <p>“纯的函数调用(pure function call)”可以被解释为：如果我可以把调用的结果用函数调用去代替，不会有任何别的影响，则说明这个函数调用是“纯”的。比如上面的<code>AAAAAAAAAA</code>可以用<code>A()</code>代替，效果是一样的。这个用术语描述就是 <em><strong>Referential Transparency</strong></em></p> <h3 id="generalized-to-specialized"><a href="#generalized-to-specialized" class="header-anchor">#</a> Generalized to Specialized</h3> <p>将一段代码提取成函数，并不一定是为了方便多次调用，即使这段代码只执行一次，函数名本身也是一个可以描述这段代码意图的信息，让代码更具有语义，对于代码阅读者更加友好。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> data<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ...*/</span> <span class="token punctuation">}</span>
<span class="token function">ajax</span><span class="token punctuation">(</span><span class="token constant">CUSTOMER_API</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> renderCustomer<span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">getCustomer</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token constant">CUSTOMER_API</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> cb<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">getCustomer</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> renderCustomer<span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">getCurrentCustomer</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">getCustomer</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">getCurrentCustomer</span><span class="token punctuation">(</span>renderCustomer<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>函数参数的顺序：通用的 -&gt; 专有的</p> <h4 id="partial-application"><a href="#partial-application" class="header-anchor">#</a> Partial Application</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> data<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ...*/</span> <span class="token punctuation">}</span>

<span class="token keyword">const</span> getCustomer <span class="token operator">=</span> <span class="token function">partial</span><span class="token punctuation">(</span>ajax<span class="token punctuation">,</span> <span class="token constant">CUSTOMER_API</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> getCurrentCustomer <span class="token operator">=</span> <span class="token function">partial</span><span class="token punctuation">(</span>getCustomer<span class="token punctuation">,</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">getCustomer</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> renderCustomer<span class="token punctuation">)</span>
<span class="token function">getCurrentCustomer</span><span class="token punctuation">(</span>renderCustomer<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="currying"><a href="#currying" class="header-anchor">#</a> Currying</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> ajax <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span>
  <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> data<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ...*/</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token keyword">const</span> getCustomer <span class="token operator">=</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token constant">CUSTOMER_API</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> getCurrentCustomer <span class="token operator">=</span> <span class="token function">getCustomer</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><code>curry</code>的写法比<code>partial</code>的写法更少调用工具函数</p> <h4 id="partial-application-vs-currying"><a href="#partial-application-vs-currying" class="header-anchor">#</a> Partial Application vs Currying</h4> <ol><li>他们都是将函数专有化的工具</li> <li><code>Partial Application</code>预设了一些参数，等待剩余的参数在下一次调用时传入。</li> <li><code>curry</code>没有预设任何参数，它同时接收每个参数。</li></ol> <h3 id="changing-function-shape-with-curry"><a href="#changing-function-shape-with-curry" class="header-anchor">#</a> Changing Function Shape with Curry</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x <span class="token operator">+</span> y
<span class="token punctuation">}</span>
<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">addOne</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// [1, 3, 5, 7, 9]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><code>map</code>的回调函数的形状和<code>add</code>的形状不一致，我们不能直接替换。但是我们可以用<code>curry</code>改变<code>add</code>的形状</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x <span class="token operator">+</span> y
<span class="token punctuation">}</span>
add <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// [1, 3, 5, 7, 9]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="composition"><a href="#composition" class="header-anchor">#</a> Composition</h2> <p><strong>抽象</strong> 的意图并不是将函数内容互相隐藏，重点是让函数内容互相分离。让分析和理解每个函数的内容变得更加容易。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">minus2</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token operator">+</span> <span class="token number">2</span> <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">triple</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token operator">*</span> <span class="token number">3</span> <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span>

totalCost <span class="token operator">=</span>
  basePrice <span class="token operator">+</span>
  <span class="token function">minus2</span><span class="token punctuation">(</span><span class="token function">triple</span><span class="token punctuation">(</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>我们可以用一个组合函数来组合这个操作</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">composeThree</span><span class="token punctuation">(</span><span class="token parameter">fn3<span class="token punctuation">,</span> fn2<span class="token punctuation">,</span> fn1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">composed</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">fn3</span><span class="token punctuation">(</span><span class="token function">fn2</span><span class="token punctuation">(</span><span class="token function">fn1</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">minus2</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token operator">+</span> <span class="token number">2</span> <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">triple</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token operator">*</span> <span class="token number">3</span> <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span>

<span class="token keyword">const</span> shippingRate <span class="token operator">=</span> <span class="token function">composeThree</span><span class="token punctuation">(</span>minus2<span class="token punctuation">,</span> triple<span class="token punctuation">,</span> increment<span class="token punctuation">)</span>

totalCost <span class="token operator">=</span>
  basePrice <span class="token operator">+</span>
  <span class="token function">shippingRate</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="compose-vs-pipe"><a href="#compose-vs-pipe" class="header-anchor">#</a> compose vs pipe</h3> <p>compose: 执行顺序 right to left</p> <p>pipe: 执行顺序 left to right</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>fns</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">composed</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> fns<span class="token punctuation">.</span><span class="token function">reduceRight</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prev<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">cur</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>prev<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">pipe</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>fns</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">composed</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> fns<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prev<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">cur</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>prev<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="associativity-结合律"><a href="#associativity-结合律" class="header-anchor">#</a> Associativity(结合律)</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> f <span class="token operator">=</span> <span class="token function">composeTwo</span><span class="token punctuation">(</span>
  a<span class="token punctuation">,</span>
  <span class="token function">composeTwo</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> c<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">const</span> g <span class="token operator">=</span> <span class="token function">composeTwo</span><span class="token punctuation">(</span>
  <span class="token function">composeTwo</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
  c<span class="token punctuation">,</span>
<span class="token punctuation">)</span>

f <span class="token operator">==</span> g
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="composion-with-curry"><a href="#composion-with-curry" class="header-anchor">#</a> composion with curry</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token operator">+</span> y <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">triple</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token operator">*</span> <span class="token number">3</span> <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">divBy</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token operator">/</span> y <span class="token punctuation">}</span>

<span class="token function">divBy</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token function">triple</span><span class="token punctuation">(</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>

sum <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> sum<span class="token punctuation">)</span>
divBy <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> divBy<span class="token punctuation">)</span>

<span class="token function">compose</span><span class="token punctuation">(</span>
  <span class="token function">divBy</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  triple<span class="token punctuation">,</span>
  <span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>在<code>composion</code>中使用<code>curry</code> 可以让函数的形状都变成<code>unary</code></p> <h2 id="immutability"><a href="#immutability" class="header-anchor">#</a> Immutability</h2> <p><code>Immutability</code>不是始终不变，而是不要有意料之外的改变，所有的改变应该都在我们的掌控之中。</p> <h3 id="const的不变性"><a href="#const的不变性" class="header-anchor">#</a> const的不变性</h3> <p>英语中，<code>const</code>的意思是一个事物不会改变，而js中的<code>const</code>表示的是这个变量不会被重新<code>assign</code>。当我们使用<code>const</code>定义一个数组或对象时，我们通常会无法保证这个数组或对象不被外界改变，当改变发生时，<code>const</code>这个关键字则可能会让别人感到疑惑。</p> <h3 id="value的不变性"><a href="#value的不变性" class="header-anchor">#</a> value的不变性</h3> <p>value的不变是另一个更重要的问题，我们遇到的99%关于value不变性的问题都是关于value被改变了，只有1%是来自值被重新赋值了。
当我们把一个对象或数组传进一个函数时，我们不能保证这个值不会被函数改变，也就可能导致bug的产生。这也是为什么函数式编程对于“value的不变性”如此重视，因为函数之间总是各种值的传递，如果是基本类型的还好，JavaScript本身会保护它不会被改变，但是对象和数组则不一定。</p> <h3 id="readonly的值"><a href="#readonly的值" class="header-anchor">#</a> readonly的值</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> orderDetails <span class="token operator">=</span> <span class="token punctuation">{</span>
  orderId <span class="token punctuation">:</span> <span class="token number">42</span><span class="token punctuation">,</span>
  total<span class="token punctuation">:</span> <span class="token punctuation">(</span>basePrice <span class="token operator">+</span> shipping<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">processOrder</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span>orderDetails<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>我们用<code>Object.freeze</code>可以让<code>orderDetails</code>变得只读，虽然它只是浅层的只读，但是它的意义更多是告诉代码的阅读者这里是<code>readonly</code>的。</p> <p>当然一个程序是不可能全是不变的值的，我们经常需要通过操作改变一些值，再储存到数据库里。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">processOrder</span><span class="token punctuation">(</span><span class="token parameter">order</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">&quot;status&quot;</span> <span class="token keyword">in</span> order<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    order<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">&quot;completed&quot;</span>
  <span class="token punctuation">}</span>
  <span class="token function">saveToDatabase</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>这样的代码可能会产生各种Bug。作为函数的开发者，你 <strong>必须</strong> 假设所有传进来的值都是不可以更改的。你应该永远操作的是值的副本</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">processOrder</span><span class="token punctuation">(</span><span class="token parameter">order</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> processedOrder <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>order <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">&quot;status&quot;</span> <span class="token keyword">in</span> order<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    processedOrder<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">&quot;completed&quot;</span>
  <span class="token punctuation">}</span>
  <span class="token function">saveToDatabase</span><span class="token punctuation">(</span>processedOrder<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="immutable-data-structure"><a href="#immutable-data-structure" class="header-anchor">#</a> Immutable Data Structure</h3> <p>当你需要改变一个值时，你需要的是<code>Immutable Data Structure</code>。也就是你得到的永远是这个值改变后的副本。然而如果我们需要改变一个很大的对象，每次都返回一个新对象的拷贝，我们的cpu可能会受不了。这就是<code>Immutable Data Structure</code>的强大之处，它返回的是改变的值和以前值的引用的集合，有点类似于<code>git</code>，diff了前后差异后，返回了最后的结果。</p> <p>当然目前js没有内置这种结构，目前有类似的提案，但短时间还不会实现。我们可以使用<a href="https://github.com/immutable-js/immutable-js" target="_blank" rel="noopener noreferrer">immutable.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> items <span class="token operator">=</span> Immutable<span class="token punctuation">.</span>List<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>
  textbook<span class="token punctuation">,</span>
  supplies
<span class="token punctuation">)</span>

<span class="token keyword">const</span> updatedItems <span class="token operator">=</span> items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>calculator<span class="token punctuation">)</span>
items <span class="token operator">===</span> updatedItems <span class="token comment">// false</span>
items<span class="token punctuation">.</span>size <span class="token comment">// 2</span>
updatedItems<span class="token punctuation">.</span>size <span class="token comment">// 3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><blockquote><p>Immutable Data Structure is something <strong>need</strong> to change, and need to change in a controlled way</p></blockquote> <h2 id="recursion-递归"><a href="#recursion-递归" class="header-anchor">#</a> recursion (递归)</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">isVowel</span><span class="token punctuation">(</span><span class="token parameter">char</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">,</span> <span class="token string">'i'</span><span class="token punctuation">,</span> <span class="token string">'o'</span><span class="token punctuation">,</span> <span class="token string">'u'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">countVowels</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> str<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isVowel</span><span class="token punctuation">(</span>str<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      count<span class="token operator">++</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> count
<span class="token punctuation">}</span>
<span class="token function">countVowels</span><span class="token punctuation">(</span>
  <span class="token string">'The quick brown fox jumps over the lazy dog'</span>
<span class="token punctuation">)</span>
<span class="token comment">// 11</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>上面是一段典型的命令式代码，我们必须阅读完整个代码并在脑海里模拟执行才能理解这段代码的意图。
这里我们想采用递归来解决这个问题（当然闭包不是唯一的解决手段），我们首先想一下我们需要解决的是什么问题，可以理解为：需要获取一个字符串第一个字符是元音的个数加上剩余字符的元音个数，这个for循环的<code>index</code>字段其实就是用来实现这个意图的。</p> <p>所以我们可以这样实现：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">isVowel</span><span class="token punctuation">(</span><span class="token parameter">char</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">,</span> <span class="token string">'i'</span><span class="token punctuation">,</span> <span class="token string">'o'</span><span class="token punctuation">,</span> <span class="token string">'u'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">countVowels</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>str<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span>
  <span class="token keyword">const</span> first <span class="token operator">=</span> <span class="token function">isVowel</span><span class="token punctuation">(</span>str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token keyword">return</span> first <span class="token operator">+</span> <span class="token function">countVowels</span><span class="token punctuation">(</span> str<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">countVowels</span><span class="token punctuation">(</span>
  <span class="token string">'The quick brown fox jumps over the lazy dog'</span>
<span class="token punctuation">)</span>
<span class="token comment">// 11</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>当你能把一个问题像这样拆解得很小，你就可以用递归来实现它了，这能让一个问题变成比较小的声明式。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">isVowel</span><span class="token punctuation">(</span><span class="token parameter">char</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">,</span> <span class="token string">'i'</span><span class="token punctuation">,</span> <span class="token string">'o'</span><span class="token punctuation">,</span> <span class="token string">'u'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">countVowels</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> first <span class="token operator">=</span> <span class="token function">isVowel</span><span class="token punctuation">(</span>str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>str<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> first
  <span class="token keyword">return</span> first <span class="token operator">+</span> <span class="token function">countVowels</span><span class="token punctuation">(</span> str<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token comment">// 不是尾部调用，因为first等待了countVowels的返回结果</span>
<span class="token punctuation">}</span>
<span class="token function">countVowels</span><span class="token punctuation">(</span>
  <span class="token string">'The quick brown fox jumps over the lazy dog'</span>
<span class="token punctuation">)</span>
<span class="token comment">// 11</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="stack-frames-memeory-limit"><a href="#stack-frames-memeory-limit" class="header-anchor">#</a> Stack Frames &amp;&amp; Memeory Limit</h3> <p>在生产环境中，我们比较少用到递归，因为它经常会在执行大量数据时产生堆栈溢出等问题。</p> <p>当一个函数A调用函数B时，系统会保存函数A的运行环境，同理函数B调用函数C时也会保存函数B的运行环境。我们称之为调用栈，函数A的则在栈的底部。当顶部的函数结束了这个调用，会从这个调用栈顶部开始依次<code>pop</code>清除这些调用的缓存。</p> <p>平常的开发中，函数调用栈通常层级不会很深，所以缓存也不是很大。但使用递归时，可能会有成千上百函数调用都保存在调用栈中，最终导致堆栈溢出。</p> <p>在数学理论上，递归是一个很好的解决手段，但在实际使用中，递归仍然受限于运行内存的大小。</p> <h3 id="optimization：tail-calls"><a href="#optimization：tail-calls" class="header-anchor">#</a> Optimization：tail calls</h3> <p>在ES6中已经落地的一个标准<code>PTC(proper tail calls)</code>，这是一个JavaScript的引擎优化，意味着在JavaScript中，尾部调用的内存占用会被引擎优化。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string">'use strict'</span>

<span class="token keyword">function</span> <span class="token function">diminish</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&gt;</span> <span class="token number">90</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">diminish</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">trunc</span><span class="token punctuation">(</span>x <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 最后单纯返回了一个函数的结果，是一个合适的尾部调用</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> x <span class="token operator">-</span> <span class="token number">3</span>
<span class="token punctuation">}</span>

<span class="token function">diminish</span><span class="token punctuation">(</span><span class="token number">367</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>使用PTC，首先需要有 <code>use strict</code>声明，然后需要一个函数包含了<code>return</code>，并且没有需要在函数执行后还有计算的操作。</p> <p>让我们用<code>PTC</code>重构一下之前的代码</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">use strict</span><span class="token template-punctuation string">`</span></span>
<span class="token keyword">function</span> <span class="token function">isVowel</span><span class="token punctuation">(</span><span class="token parameter">char</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">,</span> <span class="token string">'i'</span><span class="token punctuation">,</span> <span class="token string">'o'</span><span class="token punctuation">,</span> <span class="token string">'u'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">countVowels</span><span class="token punctuation">(</span><span class="token parameter">count<span class="token punctuation">,</span> str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  count <span class="token operator">+=</span> <span class="token function">isVowel</span><span class="token punctuation">(</span>str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>str<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> count
  <span class="token keyword">return</span> <span class="token function">countVowels</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> str<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 尾部调用</span>
<span class="token punctuation">}</span>
<span class="token function">countVowels</span><span class="token punctuation">(</span>
  <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token string">'The quick brown fox jumps over the lazy dog'</span>
<span class="token punctuation">)</span>
<span class="token comment">// 11</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>再进化一下</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">use strict</span><span class="token template-punctuation string">`</span></span>

<span class="token keyword">const</span> countVowels <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">countVowels</span><span class="token punctuation">(</span><span class="token parameter">count<span class="token punctuation">,</span> str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  count <span class="token operator">+=</span> <span class="token function">isVowel</span><span class="token punctuation">(</span>str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>str<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> count
  <span class="token keyword">return</span> <span class="token function">countVowels</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> str<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token function">countVowels</span><span class="token punctuation">(</span>
  <span class="token string">'The quick brown fox jumps over the lazy dog'</span>
<span class="token punctuation">)</span>
<span class="token comment">// 11</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="fusion"><a href="#fusion" class="header-anchor">#</a> Fusion</h2> <p>我们经常能看到一些<code>map</code>、<code>filter</code>、<code>reduce</code>等进行链式操作来处理数据，每个函数能做一个职责，这其实是个好事。但是当我们处理的是很多数据时，从性能层面考虑，这样链式调用就不行了。因为每一次执行其实都是在拷贝一次这个数组，当我们需要遍历1000项数据时，我们要遍历n*1000次。</p> <p>在函数式编程中，相对于一个很长的链式操作，我们更倾向于<code>composition</code>的形式。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">add1</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> v <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">mul2</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> v <span class="token operator">*</span> <span class="token number">2</span> <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">div3</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> v <span class="token operator">/</span> <span class="token number">3</span> <span class="token punctuation">}</span>

<span class="token keyword">var</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span>

<span class="token comment">// list</span>
<span class="token comment">//   .map(add1)</span>
<span class="token comment">//   .map(mul2)</span>
<span class="token comment">//   .map(div3)</span>
<span class="token comment">// [2, 4, 6, 8, 10, 12, 14]</span>

list
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token function">compose</span><span class="token punctuation">(</span>div3<span class="token punctuation">,</span> mul2<span class="token punctuation">,</span> add1<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="transducing"><a href="#transducing" class="header-anchor">#</a> transducing</h3> <p>（这是很难的一个部分, 建议参考阅读这篇文章：<a href="https://juejin.im/post/5c337b50f265da61746501bf" target="_blank" rel="noopener noreferrer">Transducers: JavaScript 中高效的数据处理 Pipeline（第 18 部分）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">add1</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> v <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">isOdd</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> v <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">total<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> total <span class="token operator">+</span> v <span class="token punctuation">}</span>

<span class="token keyword">var</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span>

list
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>add1<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>isOdd<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>我们虽然可以compose一些函数，但是像这样形状不同的函数，我们该怎么办呢。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>list
<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">allAtOnce</span><span class="token punctuation">(</span><span class="token parameter">total<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  v <span class="token operator">=</span> <span class="token function">add1</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isOdd</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    total <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span>total<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> total
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>如上面所示，我们其实是想用reduce将<code>map</code>和<code>filter</code>的功能结合起来，但是上面的代码不够声明化，我们可以用<code>transduce</code>工具来处理。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> transudcer <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>
  <span class="token function">mapReducer</span><span class="token punctuation">(</span>add1<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">filterReducer</span><span class="token punctuation">(</span>isOdd<span class="token punctuation">)</span>
<span class="token punctuation">)</span>

<span class="token function">transduce</span><span class="token punctuation">(</span>
  transducer<span class="token punctuation">,</span>
  sum<span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>我们来详细地说明一下上面的代码，先看下面这段代码</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">mapWithReduce</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> mappingFn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">mappingFn</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> list
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">filterWithReduce</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> predicateFn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">predicateFn</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> list
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">]</span>
list <span class="token operator">=</span> <span class="token function">mapWithReduce</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> add1<span class="token punctuation">)</span>
list <span class="token operator">=</span> <span class="token function">filterWithReduce</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> isOdd<span class="token punctuation">)</span>
list<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>在<code>reduce</code>里执行操作的函数，可以称之为<code>reducer</code>。在上面的代码里，我们执行了3次<code>reduce</code>操作，也就是把list复制并循环操作了3次，这其实是一种性能浪费。所以这就引出我们下面的写法：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">mapReducer</span><span class="token punctuation">(</span><span class="token parameter">mappingFn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">mappingFn</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> list
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">filterReducer</span><span class="token punctuation">(</span><span class="token parameter">predicateFn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">predicateFn</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> list
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

list
  <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token function">mapReducer</span><span class="token punctuation">(</span>add1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token function">filterReducer</span><span class="token punctuation">(</span>isOdd<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>我们把<code>mapReducer</code>和<code>filterReducer</code>提取出来，现在这3个<code>reduce</code>的形状变得越来越像了。同时我们还可以将他们之中的对于<code>list</code>的操作提取出来，同时结合curry</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">listCombination</span><span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
  <span class="token keyword">return</span> list
<span class="token punctuation">}</span>

<span class="token keyword">const</span> mapReducer <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">mapReducer</span><span class="token punctuation">(</span><span class="token parameter">mappingFn<span class="token punctuation">,</span> combineFn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">combineFn</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> <span class="token function">mappingFn</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> filterReducer <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">filterReducer</span><span class="token punctuation">(</span><span class="token parameter">predicateFn<span class="token punctuation">,</span> combineFn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">predicateFn</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">combineFn</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> list
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

list
  <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token function">mapReducer</span><span class="token punctuation">(</span>add1<span class="token punctuation">)</span><span class="token punctuation">(</span>listCombination<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token function">filterReducer</span><span class="token punctuation">(</span>isOdd<span class="token punctuation">)</span><span class="token punctuation">(</span>listCombination<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>这样<code>mapReducer</code>和<code>filterReducer</code>都变成了unary函数，所以可以演变成下面的代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> transducer <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">mapReducer</span><span class="token punctuation">(</span>add1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">filterReduer</span><span class="token punctuation">(</span>isOdd<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
list
  <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token function">transducer</span><span class="token punctuation">(</span>listCombination<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>最后我们可以进一步变成最开始我们的完整代码</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> transducer <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">mapReducer</span><span class="token punctuation">(</span>add1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">filterReduer</span><span class="token punctuation">(</span>isOdd<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token comment">// normal</span>
list
  <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token function">transducer</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment">// 函数式编程的工具方法</span>
<span class="token function">transduce</span><span class="token punctuation">(</span>
  transducer<span class="token punctuation">,</span>
  sum<span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span>

<span class="token comment">// or</span>
<span class="token function">into</span><span class="token punctuation">(</span>transducer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="data-structrue-operations"><a href="#data-structrue-operations" class="header-anchor">#</a> Data Structrue Operations</h2> <p>之前的操作我们都是在数组上进行的，我们现在想让这些<code>map</code>、<code>filter</code>、<code>reduce</code>等操作更具有普遍性，在<code>list</code>,<code>object</code>等数据结构上也能使用。</p> <h3 id="adapter"><a href="#adapter" class="header-anchor">#</a> adapter</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'Kyle'</span><span class="token punctuation">,</span>
  email<span class="token punctuation">:</span> <span class="token string">'Xxx@Qq.com'</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">mapObj</span><span class="token punctuation">(</span><span class="token parameter">mapper<span class="token punctuation">,</span> o</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> newObj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    newObj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">mapper</span><span class="token punctuation">(</span>o<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> newObj
<span class="token punctuation">}</span>

<span class="token function">mapObj</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">lower</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> val<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> obj<span class="token punctuation">)</span>

<span class="token comment">// { name: 'kyle', email: 'xxx@qq.com' }</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>同理我们可以写出<code>filterObj</code>, <code>reduceObj</code>等。</p> <h2 id="monad-fp-data-structure"><a href="#monad-fp-data-structure" class="header-anchor">#</a> Monad: FP Data Structure</h2> <blockquote><p>Monad: a pattern for pairing data with a set of predicatable behaviors that let it interact with other data+behavior pairings(monads)</p></blockquote> <p>Monad就是一种模式，用来将数据与一系列可预测的行为相匹配，让其可以与其他数据和行为能匹配。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Just</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> map<span class="token punctuation">,</span> chain<span class="token punctuation">,</span> ap <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Just</span><span class="token punctuation">(</span> <span class="token function">fn</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// aka: bind, flatMap</span>
  <span class="token keyword">function</span> <span class="token function">chain</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">ap</span><span class="token punctuation">(</span><span class="token parameter">anotherMonad</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> anotherMonad<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> fortyOne <span class="token operator">=</span> <span class="token function">Just</span><span class="token punctuation">(</span><span class="token number">41</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fortyTwo <span class="token operator">=</span> fortyOne<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">inc</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> v <span class="token operator">+</span> <span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></div> <div class="toc" data-v-2dd2a1f8 data-v-34f67542 data-v-428ca122><div data-v-2dd2a1f8><div class="toc" data-v-2dd2a1f8 data-v-34f67542><div class="toc-title" data-v-2dd2a1f8 data-v-34f67542>文章目录</div> <div class="toc-box" data-v-2dd2a1f8 data-v-34f67542><div class="toc-lists" data-v-2dd2a1f8 data-v-34f67542><div class="toc-item toc-h2 active" data-v-2dd2a1f8 data-v-34f67542><a href="#为什么要用函数式编程" title="为什么要用函数式编程" data-v-2dd2a1f8 data-v-34f67542>
            为什么要用函数式编程
          </a></div><div class="toc-item toc-h3" data-v-2dd2a1f8 data-v-34f67542><a href="#命令式vs声明式" title="命令式vs声明式" data-v-2dd2a1f8 data-v-34f67542>
            命令式vs声明式
          </a></div><div class="toc-item toc-h2" data-v-2dd2a1f8 data-v-34f67542><a href="#function" title="function" data-v-2dd2a1f8 data-v-34f67542>
            function
          </a></div><div class="toc-item toc-h3" data-v-2dd2a1f8 data-v-34f67542><a href="#副作用" title="副作用" data-v-2dd2a1f8 data-v-34f67542>
            副作用
          </a></div><div class="toc-item toc-h3" data-v-2dd2a1f8 data-v-34f67542><a href="#纯函数" title="纯函数" data-v-2dd2a1f8 data-v-34f67542>
            纯函数
          </a></div><div class="toc-item toc-h3" data-v-2dd2a1f8 data-v-34f67542><a href="#提取不纯的部分" title="提取不纯的部分" data-v-2dd2a1f8 data-v-34f67542>
            提取不纯的部分
          </a></div><div class="toc-item toc-h3" data-v-2dd2a1f8 data-v-34f67542><a href="#包含不纯部分" title="包含不纯部分" data-v-2dd2a1f8 data-v-34f67542>
            包含不纯部分
          </a></div><div class="toc-item toc-h2" data-v-2dd2a1f8 data-v-34f67542><a href="#arguments" title="Arguments" data-v-2dd2a1f8 data-v-34f67542>
            Arguments
          </a></div><div class="toc-item toc-h3" data-v-2dd2a1f8 data-v-34f67542><a href="#arguments-shape-adapter" title="Arguments shape adapter" data-v-2dd2a1f8 data-v-34f67542>
            Arguments shape adapter
          </a></div><div class="toc-item toc-h2" data-v-2dd2a1f8 data-v-34f67542><a href="#equational-reasoning" title="Equational Reasoning" data-v-2dd2a1f8 data-v-34f67542>
            Equational Reasoning
          </a></div><div class="toc-item toc-h3" data-v-2dd2a1f8 data-v-34f67542><a href="#point-free" title="point free" data-v-2dd2a1f8 data-v-34f67542>
            point free
          </a></div><div class="toc-item toc-h3" data-v-2dd2a1f8 data-v-34f67542><a href="#shape" title="shape" data-v-2dd2a1f8 data-v-34f67542>
            shape
          </a></div><div class="toc-item toc-h2" data-v-2dd2a1f8 data-v-34f67542><a href="#advanced-point-free" title="Advanced point free" data-v-2dd2a1f8 data-v-34f67542>
            Advanced point free
          </a></div><div class="toc-item toc-h2" data-v-2dd2a1f8 data-v-34f67542><a href="#closure" title="Closure" data-v-2dd2a1f8 data-v-34f67542>
            Closure
          </a></div><div class="toc-item toc-h3" data-v-2dd2a1f8 data-v-34f67542><a href="#lazy-or-eager" title="lazy or eager" data-v-2dd2a1f8 data-v-34f67542>
            lazy or eager
          </a></div><div class="toc-item toc-h3" data-v-2dd2a1f8 data-v-34f67542><a href="#memoization" title="Memoization" data-v-2dd2a1f8 data-v-34f67542>
            Memoization
          </a></div><div class="toc-item toc-h3" data-v-2dd2a1f8 data-v-34f67542><a href="#referential-transparency" title="Referential Transparency" data-v-2dd2a1f8 data-v-34f67542>
            Referential Transparency
          </a></div><div class="toc-item toc-h3" data-v-2dd2a1f8 data-v-34f67542><a href="#generalized-to-specialized" title="Generalized to Specialized" data-v-2dd2a1f8 data-v-34f67542>
            Generalized to Specialized
          </a></div><div class="toc-item toc-h3" data-v-2dd2a1f8 data-v-34f67542><a href="#changing-function-shape-with-curry" title="Changing Function Shape with Curry" data-v-2dd2a1f8 data-v-34f67542>
            Changing Function Shape with Curry
          </a></div><div class="toc-item toc-h2" data-v-2dd2a1f8 data-v-34f67542><a href="#composition" title="Composition" data-v-2dd2a1f8 data-v-34f67542>
            Composition
          </a></div><div class="toc-item toc-h3" data-v-2dd2a1f8 data-v-34f67542><a href="#compose-vs-pipe" title="compose vs pipe" data-v-2dd2a1f8 data-v-34f67542>
            compose vs pipe
          </a></div><div class="toc-item toc-h2" data-v-2dd2a1f8 data-v-34f67542><a href="#immutability" title="Immutability" data-v-2dd2a1f8 data-v-34f67542>
            Immutability
          </a></div><div class="toc-item toc-h3" data-v-2dd2a1f8 data-v-34f67542><a href="#const的不变性" title="const的不变性" data-v-2dd2a1f8 data-v-34f67542>
            const的不变性
          </a></div><div class="toc-item toc-h3" data-v-2dd2a1f8 data-v-34f67542><a href="#value的不变性" title="value的不变性" data-v-2dd2a1f8 data-v-34f67542>
            value的不变性
          </a></div><div class="toc-item toc-h3" data-v-2dd2a1f8 data-v-34f67542><a href="#readonly的值" title="readonly的值" data-v-2dd2a1f8 data-v-34f67542>
            readonly的值
          </a></div><div class="toc-item toc-h3" data-v-2dd2a1f8 data-v-34f67542><a href="#immutable-data-structure" title="Immutable Data Structure" data-v-2dd2a1f8 data-v-34f67542>
            Immutable Data Structure
          </a></div><div class="toc-item toc-h2" data-v-2dd2a1f8 data-v-34f67542><a href="#recursion-递归" title="recursion (递归)" data-v-2dd2a1f8 data-v-34f67542>
            recursion (递归)
          </a></div><div class="toc-item toc-h3" data-v-2dd2a1f8 data-v-34f67542><a href="#stack-frames-memeory-limit" title="Stack Frames &amp;&amp; Memeory Limit" data-v-2dd2a1f8 data-v-34f67542>
            Stack Frames &amp;&amp; Memeory Limit
          </a></div><div class="toc-item toc-h3" data-v-2dd2a1f8 data-v-34f67542><a href="#optimization：tail-calls" title="Optimization：tail calls" data-v-2dd2a1f8 data-v-34f67542>
            Optimization：tail calls
          </a></div><div class="toc-item toc-h2" data-v-2dd2a1f8 data-v-34f67542><a href="#fusion" title="Fusion" data-v-2dd2a1f8 data-v-34f67542>
            Fusion
          </a></div><div class="toc-item toc-h3" data-v-2dd2a1f8 data-v-34f67542><a href="#transducing" title="transducing" data-v-2dd2a1f8 data-v-34f67542>
            transducing
          </a></div><div class="toc-item toc-h2" data-v-2dd2a1f8 data-v-34f67542><a href="#data-structrue-operations" title="Data Structrue Operations" data-v-2dd2a1f8 data-v-34f67542>
            Data Structrue Operations
          </a></div><div class="toc-item toc-h3" data-v-2dd2a1f8 data-v-34f67542><a href="#adapter" title="adapter" data-v-2dd2a1f8 data-v-34f67542>
            adapter
          </a></div><div class="toc-item toc-h2" data-v-2dd2a1f8 data-v-34f67542><a href="#monad-fp-data-structure" title="Monad: FP Data Structure" data-v-2dd2a1f8 data-v-34f67542>
            Monad: FP Data Structure
          </a></div></div></div></div></div> <div style="display:none;" data-v-2dd2a1f8></div></div> <!----> <div id="gitalk-container" class="comment" data-v-428ca122></div></div></main></div> <footer class="footer" data-v-62440a6a><a href="https://blog.chenkeyi.com/atom.xml" target="_blank" class="rss" data-v-62440a6a><svg xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss" data-v-62440a6a data-v-62440a6a><path d="M4 11a9 9 0 0 1 9 9" data-v-62440a6a data-v-62440a6a></path><path d="M4 4a16 16 0 0 1 16 16" data-v-62440a6a data-v-62440a6a></path><circle cx="5" cy="19" r="1" data-v-62440a6a data-v-62440a6a></circle></svg></a> <p data-v-62440a6a>
    友情链接：
    <a href="https://wangfeia.com/" target="_blank" rel="noopener noreferrer" class="nav-link external link" data-v-62440a6a> WangF Blog</a><a href="http://neras.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external link" data-v-62440a6a> | 有只妖怪</a><a href="http://www.cnblogs.com/observernotes/" target="_blank" rel="noopener noreferrer" class="nav-link external link" data-v-62440a6a> | observernote</a><a href="http://tangyc.top/" target="_blank" rel="noopener noreferrer" class="nav-link external link" data-v-62440a6a> | 前端唐小胖</a><a href="https://blog.lyhper.com" target="_blank" rel="noopener noreferrer" class="nav-link external link" data-v-62440a6a> | lyhper Blog</a><a href="https://haofly.net/" target="_blank" rel="noopener noreferrer" class="nav-link external link" data-v-62440a6a> | 豪翔天下</a></p> <p data-v-62440a6a>All content copyright <a href="/" class="nav-link link" data-v-62440a6a>蹦蹬儿你个蹦蹬儿</a> © 2015 • All rights reserved.</p> <p data-v-62440a6a>最后更新时间：11/20/2019, 9:15:10 AM</p> <span class="visitor-count" data-v-d99d6d0e data-v-62440a6a><span id="busuanzi_container_site_uv" data-v-d99d6d0e>
    本站访客数<span id="busuanzi_value_site_uv" data-v-d99d6d0e><svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="load-icon feather feather-loader" data-v-d99d6d0e data-v-d99d6d0e><line x1="12" y1="2" x2="12" y2="6" data-v-d99d6d0e data-v-d99d6d0e></line><line x1="12" y1="18" x2="12" y2="22" data-v-d99d6d0e data-v-d99d6d0e></line><line x1="4.93" y1="4.93" x2="7.76" y2="7.76" data-v-d99d6d0e data-v-d99d6d0e></line><line x1="16.24" y1="16.24" x2="19.07" y2="19.07" data-v-d99d6d0e data-v-d99d6d0e></line><line x1="2" y1="12" x2="6" y2="12" data-v-d99d6d0e data-v-d99d6d0e></line><line x1="18" y1="12" x2="22" y2="12" data-v-d99d6d0e data-v-d99d6d0e></line><line x1="4.93" y1="19.07" x2="7.76" y2="16.24" data-v-d99d6d0e data-v-d99d6d0e></line><line x1="16.24" y1="7.76" x2="19.07" y2="4.93" data-v-d99d6d0e data-v-d99d6d0e></line></svg></span>人次
  </span> <!----></span> <script async="async" src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js" data-v-62440a6a></script></footer> <span title="回到顶部" class="go-to-top" style="display:none;" data-v-259a929b data-v-259a929b><svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-up" data-v-259a929b><polyline points="18 15 12 9 6 15" data-v-259a929b></polyline></svg></span></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.99350028.js" defer></script><script src="/assets/js/4.30ee6c09.js" defer></script><script src="/assets/js/27.722cb4e9.js" defer></script><script src="/assets/js/2.4b712851.js" defer></script>
  </body>
</html>
